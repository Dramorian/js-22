<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JavaScript Tasks Viewer</title>

  <!-- Prism.js styles and plugins -->
  <link href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/prismjs@1/plugins/line-numbers/prism-line-numbers.css" rel="stylesheet" />

  <script src="https://cdn.jsdelivr.net/npm/prismjs@1/prism.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-javascript.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1/plugins/line-numbers/prism-line-numbers.min.js"></script>

  <style>
      * {
          box-sizing: border-box;
          margin: 0;
          padding: 0;
          font-family: Arial, sans-serif;
      }

      body {
          background-color: #f5f5f5;
          padding: 20px;
      }

      .container {
          max-width: 1200px;
          margin: 0 auto;
          background-color: white;
          border-radius: 8px;
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
          padding: 20px;
      }

      h1 {
          text-align: center;
          margin-bottom: 30px;
      }

      .tasks-navigation {
          display: flex;
          justify-content: center;
          gap: 10px;
          margin-bottom: 20px;
          flex-wrap: wrap;
      }

      .task-btn {
          padding: 8px 16px;
          background-color: #3498db;
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          transition: background-color 0.3s;
      }

      .task-btn:hover {
          background-color: #2980b9;
      }

      .task-btn.active {
          background-color: #16a085;
      }

      .task-display {
          display: flex;
          flex-direction: column;
          gap: 20px;
          margin-top: 20px;
      }


      .code-container, .result-container {
          background-color: #f8f9fa;
          border-radius: 6px;
          padding: 20px;
          border: 1px solid #e0e0e0;
          height: auto;
          overflow-y: auto;
      }

      .code-container h3, .result-container h3 {
          margin-bottom: 15px;
          padding-bottom: 10px;
          border-bottom: 1px solid #ccc;
      }

      pre {
          background-color: #282c34;
          color: #abb2bf;
          padding: 15px;
          border-radius: 4px;
          overflow-x: auto;
          white-space: pre-wrap;
      }

      .result-content {
          padding: 10px;
          background-color: white;
          border-radius: 4px;
          min-height: 100px;
      }

      .error {
          color: red;
          font-weight: bold;
      }

      .console-output {
          margin-top: 15px;
          padding: 10px;
          background-color: #f0f0f0;
          border-left: 3px solid #3498db;
          font-family: monospace;
      }

      .console-title {
          font-weight: bold;
          margin-bottom: 5px;
      }

      @media (max-width: 768px) {
          .task-display {
              grid-template-columns: 1fr;
          }
      }

      .execute-btn {
          padding: 8px 16px;
          background-color: #27ae60;
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          margin-bottom: 15px;
      }

      .execute-btn:hover {
          background-color: #219653;
      }
  </style>
</head>
<body>
<div class="container">
  <h1>JavaScript Tasks Viewer</h1>

  <div class="tasks-navigation">
    <!-- кнопки задач -->
    <button class="task-btn" data-task="task-01.js">Task 1</button>
    <button class="task-btn" data-task="task-02.js">Task 2</button>
    <button class="task-btn" data-task="task-03.js">Task 3</button>
    <button class="task-btn" data-task="task-04.js">Task 4</button>
    <button class="task-btn" data-task="task-05.js">Task 5</button>
    <button class="task-btn" data-task="task-06.js">Task 6</button>
    <button class="task-btn" data-task="task-07.js">Task 7</button>
  </div>

  <div class="task-display">
    <div class="code-container">
      <h3>Code</h3>
      <pre id="code-viewer" class="line-numbers"><code class="language-javascript">Select a task to view its code</code></pre>
    </div>


    <div class="result-container">
      <h3>Result</h3>
      <button id="execute-btn" class="execute-btn" style="display:none;">Execute Code</button>
      <div id="result-viewer" class="result-content">Select a task to view its result</div>
    </div>
  </div>
</div>

<script>
  let currentTaskCode = '';
  let currentTaskFile = '';

  async function fetchTaskCode(filename) {
    try {
      const response = await fetch(`js/${filename}`);
      if (!response.ok) {
        throw new Error(`Failed to load file: ${filename}`);
      }
      return await response.text();
    } catch (error) {
      console.error('Error fetching task code:', error);
      return `// Error loading ${filename}\n// ${error.message}`;
    }
  }

  async function handleTaskClick(event) {
    const taskFilename = event.target.getAttribute('data-task');
    currentTaskFile = taskFilename;

    document.querySelectorAll('.task-btn').forEach(btn => {
      btn.classList.remove('active');
    });
    event.target.classList.add('active');

    currentTaskCode = await fetchTaskCode(taskFilename);

    const codeBlock = document.querySelector('#code-viewer code');
    codeBlock.textContent = currentTaskCode;

    Prism.highlightElement(codeBlock);

    // (Необязательно) Обновляем line numbers, если нужен resize после подстановки большого кода
    if (typeof Prism.plugins.lineNumbers !== 'undefined') {
      Prism.plugins.lineNumbers.resize(codeBlock);
    }

    document.getElementById('result-viewer').innerHTML = 'Click "Execute Code" to run this task';
    document.getElementById('execute-btn').style.display = 'block';
  }


  function executeTaskCode() {
    const resultViewer = document.getElementById('result-viewer');
    resultViewer.innerHTML = '';

    const consoleOutput = document.createElement('div');
    consoleOutput.className = 'console-output';
    consoleOutput.innerHTML = '<div class="console-title">Console Output:</div>';

    const taskOutputContainer = document.createElement('div');
    taskOutputContainer.className = 'task-output';

    resultViewer.appendChild(taskOutputContainer);
    resultViewer.appendChild(consoleOutput);

    try {
      const originalConsoleLog = console.log;
      const consoleMessages = [];

      console.log = function(...args) {
        const message = args.map(arg => typeof arg === 'object' ? JSON.stringify(arg) : String(arg)).join(' ');
        consoleMessages.push(message);
        originalConsoleLog.apply(console, args);
      };

      const sandbox = document.createElement('div');
      sandbox.id = `task-output-${currentTaskFile.replace('.js', '')}`;
      taskOutputContainer.appendChild(sandbox);

      const executeFunction = new Function('sandbox', `
          with(document) {
            const getElementById = function(id) {
              if (id === '${sandbox.id}') {
                return sandbox;
              }
              return document.getElementById(id);
            };
            ${currentTaskCode}
          }
      `);

      executeFunction(sandbox);

      console.log = originalConsoleLog;

      if (consoleMessages.length > 0) {
        const messagesDiv = document.createElement('div');
        messagesDiv.innerHTML = consoleMessages.map(msg => `<div>${msg}</div>`).join('');
        consoleOutput.appendChild(messagesDiv);
      } else {
        consoleOutput.innerHTML += '<div>No console output</div>';
      }

    } catch (error) {
      console.error('Error executing task code:', error);
      const errorDiv = document.createElement('div');
      errorDiv.className = 'error';
      errorDiv.textContent = `Error executing code: ${error.message}`;
      resultViewer.appendChild(errorDiv);
    }
  }

  document.querySelectorAll('.task-btn').forEach(button => {
    button.addEventListener('click', handleTaskClick);
  });

  document.getElementById('execute-btn').addEventListener('click', executeTaskCode);

  document.querySelector('.task-btn').click(); // автозагрузка первой задачи
</script>
</body>
</html>
